---
title: "Makeover Monday - Explore heatmap"
output: html_notebook
---

```{r setup}
library(tidyverse)
library(maps)
```

```{r}
usa <- map_data("usa")
states <- map_data("state")
```

```{r}
incometbl <- read_csv("incometbl.csv")
head(incometbl)
```

```{r}
# Spread income so we can plot heatmap by category
# and create a new column with key "region" to merge
# "states" table
incometbl2 <- incometbl %>% spread(incomecat, catpct) %>% 
              mutate(region = tolower(state)) %>% 
              select(-state)

head(incometbl2)
```

Inspirational [link](https://stackoverflow.com/questions/32148564/heatmap-plot-by-value-using-ggmap)

```{r}
head(states)
```

```{r}
# join two data sets for mapping
states2 <- states %>% left_join(incometbl2, by = "region")
head(states2)
```

```{r}
# Start mapping with one category `>150K`
states2 %>% ggplot() +
              geom_polygon(aes(x = long, y = lat, fill = `>$150K`, group = group))+
              coord_fixed(1.3)

glimpse(states2)
```

* Note how for the top income category, the states with higher portion are scattered to the northeast and California.

* We can reorganize the data table to create a grid by income levels

```{r}
# First way to create a merged table states3
states3 <- states2 %>% gather(incomecat, catpct, -region, -long, -lat, 
                   -group, -order, -subregion)


# Another way to create merged table states3
incometbl3 <- incometbl %>% mutate(region = tolower(state)) %>% select(-state)
head(incometbl3)
states3 <- states %>% left_join(incometbl3, by = "region")

# There are some missing values for DC
states3[(is.na(states3$incomecat)),]

```

```{r}
incomecat_levels <- c("$25K-$50K", "$51K-$75K",
                      "$76K-$100K", "<$25K", "$101K-$150K", ">$150K")
```


```{r}
# Try new plotting with facet
states3 %>% filter(!is.na(incomecat)) %>% 
        arrange(factor(incomecat, levels = incomecat_levels)) %>% 
            ggplot() +
            geom_polygon(aes(x = long, y = lat, 
                             fill = catpct, 
                             group = group)) +
            facet_wrap(.~ incomecat) +
            coord_fixed(1.3)
```


